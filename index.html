<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookMate - All in One Booking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header Styles */
        header {
            background-color: #fff;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
        }
        
        .flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 14px;
            border-radius: 20px;
        }
        
        nav a:hover, nav a.active {
            background-color: #f0f0f0;
        }
        
        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }
        
        /* Hero Section */
        .hero {
            background-color: #fff;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .hero h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .hero p {
            margin-bottom: 20px;
            color: #555;
        }
        
        /* Quick Access */
        .quick {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 30px;
        }
        
        .quick div {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            color: #333;
            text-align: center;
            transition: all 0.3s;
        }
        
        .quick div:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
        }
        
        /* Page Sections */
        .page {
            display: none;
            animation: fade 0.4s;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fade {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,.1);
            overflow: hidden;
            transition: .3s;
        }
        
        .card:hover {
            transform: translateY(-4px);
        }
        
        .card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }
        
        .card-content {
            padding: 15px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .card-price {
            color: #e74c3c;
            font-weight: 700;
        }
        
        .card-price::before {
            content: "‚Çπ";
        }
        
        .add-cart {
            background: #e74c3c;
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        
        .add-cart:hover {
            background: #c0392b;
        }
        
        /* Cart */
        .cart-item {
            display: flex;
            justify-content: space-between;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .cart-total {
            font-weight: 700;
            font-size: 18px;
            text-align: right;
            margin-top: 15px;
        }
        
        /* Footer */
        footer {
            background: #2c3e50;
            color: #ccc;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        footer a {
            color: #ccc;
            text-decoration: none;
        }
        
        footer a:hover {
            color: #fff;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: left;
        }
        
        .modal-content label {
            display: block;
            margin-top: 10px;
            font-weight: 600;
        }
        
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        
        .modal-content button {
            margin-top: 15px;
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: #e74c3c;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        
        .modal-content button:hover {
            background: #c0392b;
        }
        
        .close {
            float: right;
            font-size: 22px;
            cursor: pointer;
        }
        
        .seat, .room {
            background: #e74c3c;
            color: #fff;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .seat.selected, .room.selected {
            background: #2c3e50;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .flex {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .cards {
                grid-template-columns: 1fr;
            }
            
            .quick {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container flex">
            <div class="logo"><i class="fas fa-ticket-alt"></i> BookMate</div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="movies">Movies</a></li>
                    <li><a href="#" class="nav-link" data-page="flights">Flights</a></li>
                    <li><a href="#" class="nav-link" data-page="trains">Trains</a></li>
                    <li><a href="#" class="nav-link" data-page="buses">Buses</a></li>
                    <li><a href="#" class="nav-link" data-page="concerts">Concerts</a></li>
                    <li><a href="#" class="nav-link" data-page="hotels">Hotels</a></li>
                    <li><a href="#" class="nav-link" data-page="cart">üõí Cart</a></li>
                </ul>
            </nav>
            <div>
                <button class="btn btn-outline" id="openSignin">Sign In</button>
                <button class="btn btn-primary" id="openSignup">Sign Up</button>
                <button class="btn btn-outline" id="openProfile" title="Profile">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Home -->
    <div class="page active" id="home">
        <section class="hero">
            <h1>Book Everything in One Place</h1>
            <p>Movies, Flights, Trains, Buses, Concerts, Hotels ‚Äî all at your fingertips!</p>
            <button class="btn btn-primary" onclick="openModal()">Book Now</button>
            <div class="quick">
                <div data-page="movies"><i class="fas fa-film"></i><br>Movies</div>
                <div data-page="flights"><i class="fas fa-plane"></i><br>Flights</div>
                <div data-page="trains"><i class="fas fa-train"></i><br>Trains</div>
                <div data-page="buses"><i class="fas fa-bus"></i><br>Buses</div>
                <div data-page="concerts"><i class="fas fa-music"></i><br>Concerts</div>
                <div data-page="hotels"><i class="fas fa-hotel"></i><br>Hotels</div>
            </div>
        </section>
    </div>

    <!-- Movies -->
    <div class="page" id="movies">
        <div class="container">
            <h2>üé¨ Indian Movies</h2>
            <div class="cards">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1524985069026-dd778a71c7b4">
                    <div class="card-content">
                        <div class="card-title">Leo (Tamil)</div>
                        <div class="card-price">180</div>
                        <button class="add-cart" onclick="addToCart('Leo (Tamil)',180)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1515169067865-5387ec356754">
                    <div class="card-content">
                        <div class="card-title">RRR (Telugu)</div>
                        <div class="card-price">220</div>
                        <button class="add-cart" onclick="addToCart('RRR (Telugu)',220)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1608889175123-7423f4c09f37">
                    <div class="card-content">
                        <div class="card-title">Pathaan (Hindi)</div>
                        <div class="card-price">200</div>
                        <button class="add-cart" onclick="addToCart('Pathaan (Hindi)',200)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Flights -->
    <div class="page" id="flights">
        <div class="container">
            <h2>‚úàÔ∏è Flights in India</h2>
            <div class="cards">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1504196606672-aef5c9cefc92">
                    <div class="card-content">
                        <div class="card-title">Hyderabad ‚Üí Delhi</div>
                        <div class="card-price">4500</div>
                        <button class="add-cart" onclick="addToCart('Flight: Hyderabad ‚Üí Delhi',4500)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1494232410401-ad00d5433cfa">
                    <div class="card-content">
                        <div class="card-title">Mumbai ‚Üí Chennai</div>
                        <div class="card-price">3900</div>
                        <button class="add-cart" onclick="addToCart('Flight: Mumbai ‚Üí Chennai',3900)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1485988412941-77a35537dae4">
                    <div class="card-content">
                        <div class="card-title">Kolkata ‚Üí Goa</div>
                        <div class="card-price">5200</div>
                        <button class="add-cart" onclick="addToCart('Flight: Kolkata ‚Üí Goa',5200)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trains -->
    <div class="page" id="trains">
        <div class="container">
            <h2>üöÜ Trains</h2>
            <div class="cards">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1508264165352-258a6a636bf3">
                    <div class="card-content">
                        <div class="card-title">Rajdhani Express</div>
                        <div class="card-price">1200</div>
                        <button class="add-cart" onclick="addToCart('Rajdhani Express',1200)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1523437113738-bbd3cc89fb19">
                    <div class="card-content">
                        <div class="card-title">Chennai Express</div>
                        <div class="card-price">950</div>
                        <button class="add-cart" onclick="addToCart('Chennai Express',950)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1494526585095-c41746248156">
                    <div class="card-content">
                        <div class="card-title">Duronto Express</div>
                        <div class="card-price">1100</div>
                        <button class="add-cart" onclick="addToCart('Duronto Express',1100)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Buses -->
    <div class="page" id="buses">
        <div class="container">
            <h2>üöå Buses</h2>
            <div class="cards">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1581712614748-785f0a4363af">
                    <div class="card-content">
                        <div class="card-title">Bangalore ‚Üí Mysuru</div>
                        <div class="card-price">450</div>
                        <button class="add-cart" onclick="addToCart('Bus: Bangalore ‚Üí Mysuru',450)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1576485290812-34c3d3a3b3b9">
                    <div class="card-content">
                        <div class="card-title">Hyderabad ‚Üí Vijayawada</div>
                        <div class="card-price">600</div>
                        <button class="add-cart" onclick="addToCart('Bus: Hyderabad ‚Üí Vijayawada',600)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267">
                    <div class="card-content">
                        <div class="card-title">Pune ‚Üí Mumbai</div>
                        <div class="card-price">500</div>
                        <button class="add-cart" onclick="addToCart('Bus: Pune ‚Üí Mumbai',500)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Concerts -->
    <div class="page" id="concerts">
        <div class="container">
            <h2>üé§ Concerts</h2>
            <div class="cards">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2">
                    <div class="card-content">
                        <div class="card-title">Arijit Singh Live - Mumbai</div>
                        <div class="card-price">2500</div>
                        <button class="add-cart" onclick="addToCart('Arijit Singh Live - Mumbai',2500)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1507878866276-a947ef722fee">
                    <div class="card-content">
                        <div class="card-title">Sunburn Goa 2025</div>
                        <div class="card-price">3500</div>
                        <button class="add-cart" onclick="addToCart('Sunburn Goa 2025',3500)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063">
                    <div class="card-content">
                        <div class="card-title">Sid Sriram Night - Hyderabad</div>
                        <div class="card-price">1800</div>
                        <button class="add-cart" onclick="addToCart('Sid Sriram Night - Hyderabad',1800)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hotels -->
    <div class="page" id="hotels">
        <div class="container">
            <h2>üè® Hotels</h2>
            <div class="cards">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1501117716987-c8e1ecb2101a">
                    <div class="card-content">
                        <div class="card-title">Taj Palace, Delhi</div>
                        <div class="card-price">8500</div>
                        <button class="add-cart" onclick="addToCart('Taj Palace, Delhi',8500)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945">
                    <div class="card-content">
                        <div class="card-title">Leela Palace, Bengaluru</div>
                        <div class="card-price">7200</div>
                        <button class="add-cart" onclick="addToCart('Leela Palace, Bengaluru',7200)">Add to Cart</button>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1578683010236-d716f9a3f461">
                    <div class="card-content">
                        <div class="card-title">Grand Hyatt, Goa</div>
                        <div class="card-price">9500</div>
                        <button class="add-cart" onclick="addToCart('Grand Hyatt, Goa',9500)">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Page -->
    <div class="page" id="cart">
        <div class="container">
            <h2>üõí Your Cart</h2>
            <div id="cartItems"></div>
            <div id="cartTotal" class="cart-total"></div>
            <button class="btn btn-primary" onclick="showBookings()" style="margin-top:15px;">View Previous Bookings</button>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Enter Your Details</h2>
            <form id="bookingForm">
                <label>Name:</label><input type="text" id="name" required>
                <label>Email:</label><input type="email" id="email" required>
                <label>Address:</label><input type="text" id="address" required>
                <label>Logged In:</label>
                <select id="logged_in" required><option value="true">True</option><option value="false">False</option></select>
                <button type="button" onclick="submitBooking()">Submit</button>
            </form>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div id="signinModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSignin()">&times;</span>
            <h2>Sign In</h2>
            <form id="signinForm">
                <label>Email:</label><input type="email" id="signinEmail" required>
                <label>Password:</label><input type="password" id="signinPassword" required>
                <button type="button" onclick="submitSignin()">Sign In</button>
            </form>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSignup()">&times;</span>
            <h2>Create Account</h2>
            <form id="signupForm">
                <label>Name:</label><input type="text" id="signupName" required>
                <label>Email:</label><input type="email" id="signupEmail" required>
                <label>Password:</label><input type="password" id="signupPassword" required>
                <label>Confirm Password:</label><input type="password" id="confirmPassword" required>
                <button type="button" onclick="submitSignup()">Sign Up</button>
            </form>
        </div>
    </div>

    <!-- Seat/Room Selection Modal -->
    <div id="seatsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSeats()">&times;</span>
            <h2 id="seatsTitle">Select Seats / Rooms</h2>
            <div id="seatsContainer" style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:15px;"></div>
            <button type="button" onclick="confirmSeats()">Book Selected</button>
        </div>
    </div>

    <!-- Previous Bookings Modal -->
    <div id="bookingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBookings()">&times;</span>
            <h2>Previous Bookings</h2>
            <div id="previousBookings"></div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfile()">&times;</span>
            <h2>User Profile</h2>
            <p><strong>Name:</strong> <span id="profileName"></span></p>
            <p><strong>Email:</strong> <span id="profileEmail"></span></p>
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <footer>
        <div class="container flex">
            <p>¬© 2025 BookMate. All Rights Reserved.<br> $ MTech CSE-AIDS T.Omkar 2501050207. $ MTech CSE-  SAi Ganesh 2501050210<br> $ MTech CSE-  Bhairav 2502050 .$ MTech CSE-  2502050</p>
            <p><a href="#">Privacy</a> | <a href="#">Terms</a></p>
        </div>
    </footer>

    <script>
        let cart = [];
        let currentUser = null;
        let selectedSeats = [];

        // Navigation
        document.querySelectorAll('.nav-link,.quick div').forEach(el => el.addEventListener('click', () => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            const id = el.getAttribute('data-page');
            if (id) {
                document.getElementById(id).classList.add('active');
                document.querySelectorAll('.nav-link[data-page="' + id + '"]').forEach(n => n.classList.add('active'));
            }
            window.scrollTo(0, 0);
        }));

        // Booking Modal
        function openModal() { 
            if (cart.length === 0) {
                alert("‚ùå Your cart is empty! Add items before booking.");
                return;
            }
            document.getElementById("bookingModal").style.display = "flex"; 
        }
        function closeModal() { document.getElementById("bookingModal").style.display = "none"; }

        // Cart System
        function addToCart(name, price) {
            cart.push({ name, price });
            updateCart();
            alert(`‚úÖ ${name} added to cart!`);
        }
        
        function updateCart() {
            const cartDiv = document.getElementById("cartItems");
            const totalDiv = document.getElementById("cartTotal");
            cartDiv.innerHTML = "";
            let total = 0;
            cart.forEach((item, i) => {
                total += item.price;
                cartDiv.innerHTML += `<div class='cart-item'><span>${item.name}</span><span>‚Çπ${item.price}</span></div>`;
            });
            totalDiv.innerHTML = `Total: ‚Çπ${total}`;
        }

        // Sign In / Sign Up
        document.getElementById("openSignin").onclick = () => document.getElementById("signinModal").style.display = "flex";
        document.getElementById("openSignup").onclick = () => document.getElementById("signupModal").style.display = "flex";
        function closeSignin() { document.getElementById("signinModal").style.display = "none"; }
        function closeSignup() { document.getElementById("signupModal").style.display = "none"; }
        document.getElementById("openProfile").onclick = () => {
            if (currentUser) {
                showProfile();
            } else {
                document.getElementById("signinModal").style.display = "flex";
            }
        };

        // UPDATED Sign In
        async function submitSignin() {
            const email = document.getElementById("signinEmail").value.trim();
            const password = document.getElementById("signinPassword").value.trim();

            if (!email || !password) {
                alert("‚ùå Please fill all the fields!");
                return;
            }

            try {
                const response = await fetch("http://localhost:8080/api/auth/signin", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();
                
                if (response.ok) {
                    currentUser = {
                        token: result.token,
                        name: result.name,
                        email: result.email,
                        userId: result.userId
                    };

                    alert("‚úÖ Signed in successfully!");
                    closeSignin();
                    document.getElementById("signinForm").reset();
                    showProfile();
                } else {
                    alert("‚ùå Sign-in failed: " + (result.error || "Invalid credentials"));
                }
            } catch (error) {
                console.error("Error:", error);
                alert("‚ùå Unable to connect to server!");
            }
        }

        // UPDATED Sign Up
        async function submitSignup() {
            const name = document.getElementById("signupName").value.trim();
            const email = document.getElementById("signupEmail").value.trim();
            const password = document.getElementById("signupPassword").value.trim();
            const confirmPassword = document.getElementById("confirmPassword").value.trim();

            if (!name || !email || !password || !confirmPassword) {
                alert("‚ùå Please fill all the fields!");
                return;
            }

            if (password !== confirmPassword) {
                alert("‚ùå Passwords do not match!");
                return;
            }

            const signupData = { name, email, password };

            try {
                const response = await fetch("http://localhost:8080/api/auth/signup", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(signupData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert("‚úÖ Account created successfully!");
                    closeSignup();
                    document.getElementById("signupForm").reset();
                    
                    // Auto-login after signup
                    currentUser = {
                        token: result.token,
                        name: name,
                        email: email,
                        userId: result.userId
                    };
                } else {
                    alert("‚ùå Sign-up failed: " + (result.error || "Unknown error"));
                }
            } catch (error) {
                console.error("Error:", error);
                alert("‚ùå Unable to connect to server!");
            }
        }

        // FIXED Booking Form Submission
        async function submitBooking() {
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();
            const address = document.getElementById("address").value.trim();
            const loggedIn = document.getElementById("logged_in").value === "true";

            if (!name || !email || !address) {
                alert("‚ùå Please fill all the fields!");
                return;
            }

            if (cart.length === 0) {
                alert("‚ùå Your cart is empty!");
                return;
            }

            // Calculate total price
            const totalPrice = cart.reduce((sum, item) => sum + item.price, 0);
            
            // Create booking data
            const bookingData = {
                name,
                email,
                address,
                loggedIn,
                itemName: cart.map(item => item.name).join(", "),
                price: totalPrice,
                selectedSeats: "A1,B2", // Default sample
                bookingType: "general"
            };

            try {
                const response = await fetch("http://localhost:8080/api/bookings/add", {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json",
                        ...(currentUser && currentUser.token && { "Authorization": `Bearer ${currentUser.token}` })
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert("‚úÖ Booking submitted successfully!");
                    closeModal();
                    document.getElementById("bookingForm").reset();
                    cart = [];
                    updateCart();
                } else {
                    alert("‚ùå Booking failed: " + (result.message || "Unknown error"));
                }
            } catch (error) {
                console.error("Error:", error);
                alert("‚ùå Unable to connect to server!");
            }
        }

        // Open Seats/Rooms Modal
        function openSeats(title, type) {
            document.getElementById("seatsTitle").innerText = title;
            const container = document.getElementById("seatsContainer");
            container.innerHTML = "";
            let count = type === "hotel" ? 20 : 30;
            for (let i = 1; i <= count; i++) {
                const div = document.createElement("div");
                div.className = type === "hotel" ? "room" : "seat";
                div.innerText = i;
                div.onclick = () => div.classList.toggle("selected");
                container.appendChild(div);
            }
            document.getElementById("seatsModal").style.display = "flex";
        }

        function showProfile() {
            if (!currentUser) {
                alert("No user data available");
                return;
            }
            document.getElementById('profileName').innerText = currentUser.name || "N/A";
            document.getElementById('profileEmail').innerText = currentUser.email || "N/A";
            document.getElementById("profileModal").style.display = "flex";
        }

        function closeProfile() {
            document.getElementById("profileModal").style.display = "none";
        }

        function logout() {
            currentUser = null;
            closeProfile();
            alert("Logged out successfully");
        }

        // Close Seats Modal
        function closeSeats() { document.getElementById("seatsModal").style.display = "none"; }

        // Confirm Seats / Rooms Booking
        function confirmSeats() {
            const selected = [...document.querySelectorAll(".seat.selected, .room.selected")].map(e => e.innerText);
            if (selected.length === 0) { 
                alert("‚ùå Select at least one seat/room!"); 
                return; 
            }
            
            const title = document.getElementById("seatsTitle").innerText;
            const seatInfo = selected.join(",");
            
            alert(`‚úÖ Booked: ${selected.join(", ")}`);
            
            // Save to cart as new item with seat information
            addToCart(`${title} - Seats/Rooms: ${seatInfo}`, selected.length * 100);
            closeSeats();
        }

        // FIXED showBookings to show backend data
    
// Add this function to test the token
async function testTokenAccess() {
    if (!currentUser || !currentUser.token) {
        alert("No user logged in");
        return;
    }

    try {
        console.log("Testing token:", currentUser.token);
        
        // Test 1: Check if we can access a public endpoint
        const publicTest = await fetch("http://localhost:8080/api/bookings/test");
        console.log("Public test:", await publicTest.text());
        
        // Test 2: Check if we can access the user bookings endpoint
        const userBookings = await fetch("http://localhost:8080/api/bookings/user", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${currentUser.token}`,
                "Content-Type": "application/json"
            }
        });
        
        console.log("Bookings response status:", userBookings.status);
        
        if (userBookings.ok) {
            const bookings = await userBookings.json();
            console.log("Bookings data:", bookings);
            alert("‚úÖ Token has booking access!");
        } else {
            alert(`‚ùå Bookings access failed: HTTP ${userBookings.status}`);
        }
        
    } catch (error) {
        console.error("Test failed:", error);
        alert("Test failed: " + error.message);
    }
}

// Call from browser console: testTokenAccess()

function logoutAndRetry() {
    currentUser = null;
    document.getElementById("bookingsModal").style.display = "none";
    document.getElementById("signinModal").style.display = "flex";
    alert("Please sign in again to access your bookings.");
}

// Also update the sign-in success handler to verify token works
async function submitSignin() {
    const email = document.getElementById("signinEmail").value.trim();
    const password = document.getElementById("signinPassword").value.trim();

    if (!email || !password) {
        alert("‚ùå Please fill all the fields!");
        return;
    }

    try {
        const response = await fetch("http://localhost:8080/api/auth/signin", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        const result = await response.json();
        
        if (response.ok && result.token) {
            currentUser = {
                token: result.token,
                name: result.name,
                email: result.email,
                userId: result.userId
            };

            console.log("User signed in successfully, token received");
            
            // Test if token actually works by making a test request
            try {
                const testResponse = await fetch("http://localhost:8080/api/bookings/user", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${result.token}`,
                        "Content-Type": "application/json"
                    }
                });
                
                if (testResponse.status === 403) {
                    alert("‚ö†Ô∏è Signed in but token doesn't have booking access. Please contact support.");
                    return;
                }
            } catch (testError) {
                console.warn("Token test failed:", testError);
            }

            alert("‚úÖ Signed in successfully!");
            closeSignin();
            document.getElementById("signinForm").reset();
            showProfile();
        } else {
            alert("‚ùå Sign-in failed: " + (result.error || "Invalid credentials"));
        }
    } catch (error) {
        console.error("Error:", error);
        alert("‚ùå Unable to connect to server!");
    }
}

        // Function to cancel booking from backend
        async function cancelBookingFromBackend(bookingId) {
            if (!confirm("Are you sure you want to cancel this booking?")) {
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:8080/api/bookings/${bookingId}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${currentUser.token}`
                    }
                });
                
                if (response.ok) {
                    alert("‚úÖ Booking cancelled successfully!");
                    showBookings(); // Refresh the list
                } else {
                    alert("‚ùå Failed to cancel booking");
                }
            } catch (error) {
                console.error("Error cancelling booking:", error);
                alert("‚ùå Unable to cancel booking");
            }
        }

        // Cancel Booking from local cart
        function cancelBooking(index) {
            const item = cart.splice(index, 1)[0];
            updateCart();
            showBookings();
            alert(`‚ùå Booking for "${item.name}" cancelled!`);
        }

        // Close Bookings Modal
        function closeBookings() { document.getElementById("bookingsModal").style.display = "none"; }

        // Attach click to cards to open seats modal
        document.querySelectorAll("#movies .card,#flights .card,#trains .card,#buses .card,#concerts .card,#hotels .card").forEach(card => {
            card.addEventListener("click", (e) => {
                if (e.target.tagName === "BUTTON") return;
                const parent = card.closest(".page").id;
                const title = card.querySelector(".card-title").innerText;
                openSeats(title, parent === "hotels" ? "hotel" : "seat");
            });
        });
                // Close Bookings Modal
        function closeBookings() { document.getElementById("bookingsModal").style.display = "none"; }

        // Add this function to show previous bookings
        async function showBookings() {
            if (!currentUser) {
                alert("‚ùå Please sign in to view your previous bookings!");
                document.getElementById("signinModal").style.display = "flex";
                return;
            }

            try {
                console.log("Fetching bookings for user:", currentUser.userId);
                console.log("Using token:", currentUser.token);

                const response = await fetch("http://localhost:8080/api/bookings/user", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${currentUser.token}`,
                        "Content-Type": "application/json"
                    }
                });

                console.log("Response status:", response.status);
                
                if (response.ok) {
                    const bookings = await response.json();
                    console.log("Bookings received:", bookings);
                    
                    const bookingsContainer = document.getElementById("previousBookings");
                    
                    if (bookings.length === 0) {
                        bookingsContainer.innerHTML = "<p>No previous bookings found.</p>";
                    } else {
                        bookingsContainer.innerHTML = bookings.map(booking => `
                            <div class="cart-item" style="margin-bottom: 10px;">
                                <div>
                                    <strong>${booking.itemName || 'N/A'}</strong><br>
                                    <span>Price: ‚Çπ${booking.price || 'N/A'}</span><br>
                                    <span>Date: ${booking.bookingDate ? new Date(booking.bookingDate).toLocaleDateString() : 'N/A'}</span><br>
                                    <span>Status: ${booking.status || 'Confirmed'}</span>
                                </div>
                                <div>
                                    <button class="btn btn-outline" onclick="cancelBookingFromBackend('${booking._id || booking.id}')">Cancel</button>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    document.getElementById("bookingsModal").style.display = "flex";
                } else if (response.status === 401 || response.status === 403) {
                    alert("‚ùå Session expired. Please sign in again.");
                    logoutAndRetry();
                } else {
                    const errorText = await response.text();
                    console.error("Error response:", errorText);
                    alert("‚ùå Failed to load bookings. Please try again.");
                }
            } catch (error) {
                console.error("Error fetching bookings:", error);
                alert("‚ùå Unable to connect to server. Please check your connection.");
            }
        }

        // Add this function to handle logout and retry
        function logoutAndRetry() {
            currentUser = null;
            document.getElementById("bookingsModal").style.display = "none";
            document.getElementById("signinModal").style.display = "flex";
        }

        // Attach click to cards to open seats modal
        document.querySelectorAll("#movies .card,#flights .card,#trains .card,#buses .card,#concerts .card,#hotels .card").forEach(card => {
            card.addEventListener("click", (e) => {
                if (e.target.tagName === "BUTTON") return;
                const parent = card.closest(".page").id;
                const title = card.querySelector(".card-title").innerText;
                openSeats(title, parent === "hotels" ? "hotel" : "seat");
            });
        });
    </script>
</body>
</html>
